Клиент:
    отправка сообщений
    отправка бродкаса
    установление соединений
Сервер:
    прослушка бродкастов
    принятие соединений
    прослушка соединений

1) Запрос истории
2) Ответ на запрос истории
3) Обычное сообщение
4) Отключение

Примечание 1: будем считать, что за время выполнения шагов 3-5 в сети не может появиться новый Peer
Примечание 2: будем считать, что за время обновления истории новых сообщений не приходит
Примечание 3: будем считать, что сообщение, отправленное раньше, не может обработаться позже

Итак, жизнь отдельного Peer'a выглядт следующим образом.
1) Начать принимать соединения
2) Отправить бродкаст
3) Начать прослушивать сеть на соединения
4) Запросить по первому установленному соединению историю сети
5) Подождать обновления истории
6) Начать слушать бродкасты
7) Отобразить историю

Условно можно выделить Chat, BroadcastServer, ConnectionServer, ConnectionListener

Как лучше всего осуществлять подключение?
Где хранить connections?
Нужны connections в BroadcastServer, ConnectionServer, Chat, ConnectionListener

Если раскидать код по работе с определёнными видами сообщений по сервисам, то нужны следующие сервисы
1) ConnectionService
2) BroadcastService
3) HistoryService
4) TextService

Есть некоторые особенные сервисы, которые должны выполняться в отдельном потоке
Есть обычные сервисы, которые будут использоваться другими потоками